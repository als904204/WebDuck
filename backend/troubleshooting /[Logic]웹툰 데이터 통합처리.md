# 웹툰 데이터 통합 처리에 대한 고민

---

## 고민 배경
- 웹툰 데이터 구성 도중 초반엔 수작업으로 일일이 웹툰 데이터를 가져와 저장함
- 비효율적인 거 같아 크롤링을 하려 했으나 모두 robots.txt disallow 였음
- 만화 규장각과 Korea Webtoon API 에서 제공하는 웹툰 API를 사용하기로 함


## 고민

> Korea Webtoon API와 만화 규장각 Open API를 이용해 DB에 저장하려는 과정 중에 아래와 같은 문제점이 발생해 어떻게 처리할 것인지에 대해 고민이었습니다.

### 문제 상황 
1. 각 Open API 서비스별 제공해주는 웹툰 정보 형식이 다름. 그러므로 필요한 부분만 추출해야 함

![img.png](img/w1.png)

2. Korea Webtoon API는 트래픽 제한 없이 요청할 수 있고, 만화 규장각 API는 하루 최대 1,000개의 요청만 요청할 수 있음

![img_1.png](img/w2.png)

3. 페이지별로 제공되는 데이터가 서로 다름 

![img_2.png](img/w3.png)


---

## 첫번째로 생각한 해결 방안 

#### 1. 저장 후 상태 값 지정
트래픽 제한이 없는 Korea Webtoon API 의 모든 웹툰 데이터를 [INACTIVE] 상태로 DB에 저장

![img_5.png](img/w6.png)

#### 2. 1천건 데이터 요청
만화 규장각 API 1천개 데이터 요청

![img_4.png](img/w5.png)

#### 3. 데이터가 동일한지 비교
1. DB에 저장된 [INACTIVE] 상태인 웹툰 데이터를 조회

2. DB웹툰 제목과 API 웹툰 제목이 동일한지 비교

![img_3.png](img/w4.png)

#### 4. 데이터 가공 후 DB 반영
제목이 일치한 웹툰 데이터 가공 후, DB에 수정한 웹툰 데이터 반영

![img_6.png](img/w7.png)

#### 5. 위 1번부터 4번 과정을 만화 규장각 API의 응답데이터가 0일때까지 반복

#### 6. 남은 데이터 삭제
만화 규장각에 있는 모든 API를 요청했음에도, 여전히 DB에 남아있는 INACTIVE 웹툰 삭제

![img_7.png](img/w8.png)



###  문제점

- 필요 없는 데이터들도 DB에 저장하는 쿼리 비용 발생
- 매번 모든 INACTIVE 상태인 웹툰을 메모리에 띄워 비교하는 비용 발생
- 남은 데이터 삭제 또한 쿼리 비용 발생

---

## 두 번째로 생각한 해결 방안 ✔️
> 일일 1000 트래픽 제한이지만 생각보다 널널한(?) 트래픽

### 1. 트래픽 제한 없는 Korea Webtoon API 요청 후 List 로 저장

![img.png](img.png)

응답받은 Korea 웹툰 목록을 List 형태로 저장

### 2. 만화 규장각 API 요청 후 Map 저장
![img_2.png](img_2.png)

1. 응답받은 만화 규장각 웹툰 목록을 Map 형태로 저장
2. Map으로 저장한 이유는 만화 규장각에서 응답온 데이터 중 중복된 데이터 제거 및 제목을 기준으로 Korea 데이터와 병합해야 되기 때문에 Map으로 저장

### 3. 두 데이터 간 비교 후, 제목이 같을 경우 병합
1. 만화 규장각 Map에서 Korea 웹툰 제목과 일치하는 항목 검색
2. 일치하는 항목이 있으면, 두 웹툰 정보를 병합하고 결과를 리스트에 추가
3. 병합 과정을 거친 후, 장르 설정한 다음 DB 저장

---

## 느낀 점

> 이 단계를 통해 서로 다른 API에서 데이터를 가져와 통합하는 과정에서 DB 자원 낭비, 데이터 중복 제거, 데이터 형식 차이 해결, 비교 및 병합 로직 등을 고민했어야 했습니다.
> 
> 중복 제거를 위해 Set과 Map 중 어떤 걸 사용해야 되는지 고민했었는데, 웹툰 제목을 기준으로 일치하는 데이터를 찾아 병합하는 과정이 있었기 때문에 Map 자료구조를 선택했습니다.
> 